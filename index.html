<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>íˆë¼ê°€ë‚˜ Â· ê°€íƒ€ì¹´ë‚˜ ì•”ê¸° ì—°ìŠµ</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;600;700&family=Noto+Sans+JP:wght@500;700&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#0e1116;
      --card:#141a22;
      --accent:#6ea8fe;
      --accent-2:#9cffd0;
      --text:#e6ebf2;
      --muted:#9aa7b5;
      --danger:#ff6b6b;
      --success:#46e0a5;
      --shadow: 0 10px 30px rgba(0,0,0,.35);
      --ring: 0 0 0 3px rgba(110,168,254,.35);
    }
    *{box-sizing:border-box}
    body{
      margin:0; background:
        radial-gradient(1200px 800px at 80% -10%, #1f2b3a 0%, transparent 60%),
        radial-gradient(1000px 700px at -10% 120%, #1b2a22 0%, transparent 60%),
        var(--bg);
      color:var(--text);
      font-family:"Noto Sans KR",system-ui,-apple-system,Segoe UI,Roboto,"Noto Sans JP",sans-serif;
      min-height:100vh; display:flex; align-items:center; justify-content:center; padding:24px;
    }
    .app{ width:min(100%, 980px); }
    .header{
      display:flex; align-items:center; justify-content:space-between; gap:16px; margin-bottom:16px;
    }
    .brand{ display:flex; align-items:center; gap:12px; }
    .logo{
      width:42px; height:42px; border-radius:12px;
      background: linear-gradient(135deg, var(--accent), var(--accent-2));
      display:grid; place-items:center; color:#0b1220; font-weight:800;
      box-shadow: var(--shadow);
      font-family:"Noto Sans JP"; font-size:22px;
    }
    .brand h1{ font-size:20px; margin:0; letter-spacing:.2px; }
    .controls{
      display:flex; flex-wrap:wrap; gap:10px; align-items:center; justify-content:flex-end;
    }
    .control{
      background:#0f151d; border:1px solid #203044; color:var(--text);
      padding:10px 12px; border-radius:12px; display:flex; align-items:center; gap:8px;
    }
    select, input[type="checkbox"], input[type="radio"]{ accent-color: var(--accent); }
    select{
      background:transparent; color:var(--text); border:none; outline:none; font-weight:600;
    }
    .seg{
      display:flex; background:#0b1118; border:1px solid #203044; border-radius:10px; overflow:hidden;
    }
    .seg label{
      padding:8px 10px; cursor:pointer; color:#bcd0e5; font-weight:700; font-size:14px;
    }
    .seg input{ display:none; }
    .seg input:checked + span{
      background: linear-gradient(135deg, #6ea8fe, #53e0b8);
      color:#0b1220;
      font-weight:800;
    }
    .btn{
      background: linear-gradient(135deg, #6ea8fe, #53e0b8);
      color:#0b1220; border:none; padding:10px 16px; border-radius:12px; font-weight:800; cursor:pointer;
      box-shadow: var(--shadow);
    }
    .btn.secondary{
      background:#0f151d; color:var(--text); border:1px solid #203044; font-weight:700;
    }
    .grid{ display:grid; grid-template-columns: 1.2fr .8fr; gap:16px; }
    @media (max-width:880px){ .grid{ grid-template-columns: 1fr; } }
    .card{
      background:var(--card); border:1px solid #1f2a36; border-radius:16px; box-shadow: var(--shadow);
    }
    .stage{ padding:20px; display:flex; flex-direction:column; gap:16px; min-height:360px; }
    .prompt{
      background:#0f151d; border:1px solid #223146; border-radius:14px; display:flex; align-items:center; justify-content:center;
      min-height:180px; position:relative; overflow:hidden;
    }
    .kana{
      font-family:"Noto Sans JP", "Noto Sans KR", sans-serif;
      font-weight:700; font-size:120px; line-height:1; letter-spacing:2px;
      text-shadow: 0 8px 40px rgba(0,0,0,.45);
      transition: transform .2s ease, color .2s ease;
    }
    .kana.flash-correct{ color: var(--success); transform: scale(1.06); }
    .kana.flash-wrong{ color: var(--danger); animation: shake .28s linear; }
    @keyframes shake{
      0%,100%{ transform: translateX(0); }
      20%{ transform: translateX(-6px); }
      40%{ transform: translateX(6px); }
      60%{ transform: translateX(-4px); }
      80%{ transform: translateX(4px); }
    }
    .answer-wrap{ display:flex; gap:10px; align-items:center; flex-wrap:wrap; }
    .input{ flex:1; min-width:220px; display:flex; align-items:center; gap:8px;
      background:#0f151d; border:1px solid #223146; border-radius:12px; padding:12px 14px; }
    .ring:focus-within{ box-shadow: var(--ring); }
    .input input{
      flex:1; background:transparent; border:none; outline:none; color:var(--text); font-size:18px; font-weight:700;
    }
    .hint{ color:var(--muted); font-size:13px; }
    .actions{ display:flex; gap:8px; flex-wrap:wrap; }
    .meta{
      display:flex; align-items:center; justify-content:space-between; flex-wrap:wrap; gap:10px; color:var(--muted); font-size:14px;
    }
    .stats{ display:flex; gap:12px; }
    .stat-badge{
      background:#0f151d; border:1px solid #223146; border-radius:999px; padding:6px 10px; color:#b7c2cf;
    }
    .side{ padding:16px; }
    .side h3{ margin:6px 6px 10px; font-size:16px; color:#c9d6e5; }
    .table{ display:grid; grid-template-columns: repeat(5, 1fr); gap:10px; }
    .cell{
      background:#0f151d; border:1px solid #223146; border-radius:12px; padding:10px; text-align:center;
      display:flex; flex-direction:column; gap:4px;
    }
    .cell .k{ font-family:"Noto Sans JP"; font-weight:700; font-size:22px; }
    .cell .r{ font-size:13px; color:#9fb0c3; }
    .footer{
      margin-top:16px; display:flex; justify-content:space-between; gap:10px; color:#8fa1b5; font-size:12px; padding:0 6px;
    }
    .kbd{ background:#0f151d; border:1px solid #223146; border-radius:6px; padding:2px 6px; font-size:11px; color:#c6d2df; }
    .sublabel{ color:#8fa1b5; font-size:12px; margin-left:4px; }

    /* ì™„ë£Œ ì˜¤ë²„ë ˆì´ */
    .complete-banner{
      position:absolute; inset:0; display:none; align-items:center; justify-content:center;
      background: radial-gradient(600px 300px at 50% 50%, rgba(83,224,184,.08), transparent 60%);
      pointer-events:none;
    }
    .complete-banner.show{ display:flex; animation: fadeOut 1500ms ease forwards; }
    .complete-text{
      background: rgba(20,26,34,.8);
      border:1px solid #223146; border-radius:999px; padding:8px 14px;
      color:#d3ffe9; font-weight:800; letter-spacing:.3px;
    }
    @keyframes fadeOut{ 0%{opacity:1} 90%{opacity:1} 100%{opacity:0} }

    /* í‘œ í† ê¸€ ì‹œ ìˆ¨ê¹€ */
    .side.hidden{ display:none; }
    /* ==== CSS ì›ë³¸ ê·¸ëŒ€ë¡œ ==== */
    /* (ìƒëµ ì—†ì´ ë¶™ì—¬ë„£ê¸° â€” ì—¬ê¸°ì„  ì¤„ì„) */
  </style>
</head>
<body>
    <div class="app">
    <div class="header">
      <div class="brand">
        <div class="logo" id="logoChar">ã‚</div>
        <div>
          <h1>íˆë¼ê°€ë‚˜ Â· ê°€íƒ€ì¹´ë‚˜ ì•”ê¸° ì—°ìŠµ</h1>
          <div class="sublabel">ì•„ í–‰ë¶€í„° ì„ íƒí•œ í–‰ê¹Œì§€ ëœë¤ ì¶œì œ â€¢ ì •ë‹µì´ë©´ ìë™ ë‹¤ìŒ</div>
        </div>
      </div>
      <div class="controls">
        <div class="control">
          ë¬¸ì
          <div class="seg" role="tablist" aria-label="ë¬¸ì ì„ íƒ">
            <label>
              <input type="radio" name="syllabary" id="hiraganaMode" checked>
              <span>íˆë¼ê°€ë‚˜</span>
            </label>
            <label>
              <input type="radio" name="syllabary" id="katakanaMode">
              <span>ê°€íƒ€ì¹´ë‚˜</span>
            </label>
          </div>
        </div>
        <div class="control">
          í•™ìŠµ ë í–‰
          <select id="endRowSelect" aria-label="í•™ìŠµ ë í–‰ ì„ íƒ"></select>
        </div>
        <label class="control">
          <input type="checkbox" id="includeNCheck"> ã‚“/ãƒ³ í¬í•¨
        </label>
        <label class="control">
          <input type="checkbox" id="showTableCheck"> ë²”ìœ„ í‘œ í‘œì‹œ
        </label>
        <button class="btn" id="startBtn">ì‹œì‘ / ë¦¬ì…‹</button>
      </div>
    </div>

    <div class="grid">
      <div class="card stage">
        <div class="prompt">
          <div class="kana" id="kana">â€”</div>
          <div class="complete-banner" id="completeBanner">
            <div class="complete-text">í•œ ë°”í€´ ì™„ë£Œ! ì˜í–ˆì–´ìš” ğŸ‰</div>
          </div>
          <!-- ì»¨í˜í‹° ìº”ë²„ìŠ¤ëŠ” JSì—ì„œ í•„ìš” ì‹œ ìƒì„± -->
        </div>

        <div class="answer-wrap">
          <label class="input ring" style="flex:1">
            <input id="answer" type="text" placeholder="ë°œìŒ(í•œê¸€) ì…ë ¥ ì˜ˆ: ì•„, ì¹´, ì‹œ, ì¹˜, ì¸ ..." autocomplete="off" inputmode="text" />
          </label>
          <div class="actions">
            <button class="btn secondary" id="revealBtn" title="ì •ë‹µ ë³´ê¸°"><span>ì •ë‹µ ë³´ê¸°</span></button>
            <button class="btn secondary" id="skipBtn" title="íŒ¨ìŠ¤">íŒ¨ìŠ¤</button>
          </div>
        </div>

        <div class="meta">
          <div class="hint" id="hintArea">ë°œìŒì„ ì…ë ¥í•˜ê³  Enterë¥¼ ëˆŒëŸ¬ì£¼ì„¸ìš”.</div>
          <div class="stats">
            <div class="stat-badge">ì •ë‹µ <span id="correct">0</span></div>
            <div class="stat-badge">ì „ì²´ <span id="total">0</span></div>
            <div class="stat-badge">ì •í™•ë„ <span id="acc">0%</span></div>
            <div class="stat-badge">ì—°ì† <span id="streak">0</span></div>
          </div>
        </div>
      </div>

      <div class="card side hidden" id="sidePanel">
        <h3>í˜„ì¬ í•™ìŠµ ë²”ìœ„ í‘œ</h3>
        <div class="table" id="table"></div>
        <div class="footer">
          <div>Made: [bapjwoyo] </div>
          <div><span class="kbd">Enter</span> ì˜¤ë‹µì¼ ë•ŒëŠ” í”ë“¤ë¦¼, <span class="kbd">íŒ¨ìŠ¤</span>ë¡œ ê±´ë„ˆë›°ê¸°</div>
        </div>
      </div>
    </div>
  </div>
  <!-- ==== HTML êµ¬ì¡° ì›ë³¸ ê·¸ëŒ€ë¡œ ==== -->
  <!-- (ìƒëµ ì—†ì´ ë¶™ì—¬ë„£ê¸° â€” ì—¬ê¸°ì„  ì¤„ì„) -->

<script>
// ===== ë°ì´í„° =====
const ROWS = [
  { id:'a',  label:'ã‚ í–‰', items:[ {k:'ã‚', a:['ì•„']}, {k:'ã„', a:['ì´']}, {k:'ã†', a:['ìš°']}, {k:'ãˆ', a:['ì—']}, {k:'ãŠ', a:['ì˜¤']} ]},
  { id:'ka', label:'ã‹ í–‰', items:[ {k:'ã‹', a:['ì¹´']}, {k:'ã', a:['í‚¤']}, {k:'ã', a:['ì¿ ']}, {k:'ã‘', a:['ì¼€']}, {k:'ã“', a:['ì½”']} ]},
  { id:'sa', label:'ã• í–‰', items:[ {k:'ã•', a:['ì‚¬']}, {k:'ã—', a:['ì‹œ']}, {k:'ã™', a:['ìŠ¤']}, {k:'ã›', a:['ì„¸']}, {k:'ã', a:['ì†Œ']} ]},
  { id:'ta', label:'ãŸ í–‰', items:[ {k:'ãŸ', a:['íƒ€']}, {k:'ã¡', a:['ì¹˜']}, {k:'ã¤', a:['ì¸ ','ì“°']}, {k:'ã¦', a:['í…Œ']}, {k:'ã¨', a:['í† ']} ]},
  { id:'na', label:'ãª í–‰', items:[ {k:'ãª', a:['ë‚˜']}, {k:'ã«', a:['ë‹ˆ']}, {k:'ã¬', a:['ëˆ„']}, {k:'ã­', a:['ë„¤']}, {k:'ã®', a:['ë…¸']} ]},
  { id:'ha', label:'ã¯ í–‰', items:[ {k:'ã¯', a:['í•˜']}, {k:'ã²', a:['íˆ']}, {k:'ãµ', a:['í›„']}, {k:'ã¸', a:['í—¤']}, {k:'ã»', a:['í˜¸']} ]},
  { id:'ma', label:'ã¾ í–‰', items:[ {k:'ã¾', a:['ë§ˆ']}, {k:'ã¿', a:['ë¯¸']}, {k:'ã‚€', a:['ë¬´']}, {k:'ã‚', a:['ë©”']}, {k:'ã‚‚', a:['ëª¨']} ]},
  { id:'ya', label:'ã‚„ í–‰', items:[ {k:'ã‚„', a:['ì•¼']}, {k:'ã‚†', a:['ìœ ']}, {k:'ã‚ˆ', a:['ìš”']} ]},
  { id:'ra', label:'ã‚‰ í–‰', items:[ {k:'ã‚‰', a:['ë¼']}, {k:'ã‚Š', a:['ë¦¬']}, {k:'ã‚‹', a:['ë£¨']}, {k:'ã‚Œ', a:['ë ˆ']}, {k:'ã‚', a:['ë¡œ']} ]},
  { id:'wa', label:'ã‚ í–‰', items:[ {k:'ã‚', a:['ì™€']}, {k:'ã‚’', a:['ì˜¤','ì˜¤(ë¥¼)']} ]}
];
const N_CHAR = { id:'n', label:'ã‚“', items:[ {k:'ã‚“', a:['ì‘']} ] };

// ===== ìœ í‹¸ =====
const toKatakana = str => str.replace(/[\u3041-\u3096]/g, ch => String.fromCharCode(ch.charCodeAt(0) + 0x60));
const shuffle = arr => { const a = arr.slice(); for(let i=a.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[a[i],a[j]]=[a[j],a[i]];} return a; };
const normalize = s => (s||'').toString().trim().replace(/\s+/g,'').toLowerCase();

// ===== DOM =====
const endRowSelect = document.getElementById('endRowSelect');
const includeNCheck = document.getElementById('includeNCheck');
const showTableCheck = document.getElementById('showTableCheck');
const startBtn = document.getElementById('startBtn');
const kanaEl = document.getElementById('kana');
const answerEl = document.getElementById('answer');
const revealBtn = document.getElementById('revealBtn');
const skipBtn = document.getElementById('skipBtn');
const totalEl = document.getElementById('total');
const correctEl = document.getElementById('correct');
const accEl = document.getElementById('acc');
const streakEl = document.getElementById('streak');
const sidePanel = document.getElementById('sidePanel');
const tableEl = document.getElementById('table');
const completeBanner = document.getElementById('completeBanner');
const hiraganaMode = document.getElementById('hiraganaMode');
const katakanaMode = document.getElementById('katakanaMode');

// ===== ìƒíƒœ =====
let pool = [], order = [], idx = 0, started = false;
let total = 0, correct = 0, streak = 0;

// ===== ë“œë¡­ë‹¤ìš´ ì´ˆê¸°í™” =====
function populateEndRowSelect() {
  endRowSelect.innerHTML = '';
  ROWS.forEach((row, index) => {
    const opt = document.createElement('option');
    opt.value = index;
    let label = row.label;
    if (katakanaMode.checked) label = toKatakana(row.label.replace(' í–‰','')) + ' í–‰';
    opt.textContent = label;
    endRowSelect.appendChild(opt);
  });
}
populateEndRowSelect();
hiraganaMode.addEventListener('change', populateEndRowSelect);
katakanaMode.addEventListener('change', populateEndRowSelect);

// ===== í•™ìŠµ ë²”ìœ„ í‘œ ë Œë”ë§ =====
function renderTable() {
  tableEl.innerHTML = '';
  const endRow = Math.max(0, Math.min(ROWS.length - 1, parseInt(endRowSelect.value, 10) || ROWS.length - 1));
  let displayItems = [];
  for (let i = 0; i <= endRow; i++) {
    displayItems.push(...ROWS[i].items);
  }
  if (includeNCheck.checked) displayItems.push(...N_CHAR.items);

  if (displayItems.length === 0) {
    const empty = document.createElement('div');
    empty.className = 'cell';
    empty.innerHTML = `<div class="k">â€”</div><div class="r">í•™ìŠµ ë²”ìœ„ê°€ ë¹„ì–´ìˆìŠµë‹ˆë‹¤</div>`;
    tableEl.appendChild(empty);
    return;
  }

  displayItems.forEach(item => {
    const isKat = katakanaMode.checked;
    const char = isKat ? toKatakana(item.k) : item.k;
    const reading = Array.isArray(item.a) ? item.a.join(', ') : item.a;
    const cell = document.createElement('div');
    cell.className = 'cell';
    const kDiv = document.createElement('div');
    kDiv.className = 'k';
    kDiv.textContent = char;
    const rDiv = document.createElement('div');
    rDiv.className = 'r';
    rDiv.textContent = reading;
    cell.appendChild(kDiv);
    cell.appendChild(rDiv);
    tableEl.appendChild(cell);
  });
}
endRowSelect.addEventListener('change', renderTable);
includeNCheck.addEventListener('change', renderTable);
hiraganaMode.addEventListener('change', () => { populateEndRowSelect(); renderTable(); });
katakanaMode.addEventListener('change', () => { populateEndRowSelect(); renderTable(); });
showTableCheck.addEventListener('change', () => {
  sidePanel.classList.toggle('hidden', !showTableCheck.checked);
  if (showTableCheck.checked) renderTable();
});

// ===== ì»¨í˜í‹° =====
function launchConfetti() {
  const canvas = document.createElement('canvas');
  canvas.style.position = 'fixed';
  canvas.style.top = 0;
  canvas.style.left = 0;
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
  canvas.style.pointerEvents = 'none';
  document.body.appendChild(canvas);
  const ctx = canvas.getContext('2d');
  const particles = [];
  const colors = ['#6ea8fe', '#53e0b8', '#ff6b6b', '#ffe66d', '#9cffd0'];
  for (let i = 0; i < 120; i++) {
    particles.push({ x: Math.random()*canvas.width, y: Math.random()*canvas.height - canvas.height, w: 8, h: 8, color: colors[Math.floor(Math.random()*colors.length)], speed: 2+Math.random()*4, angle: Math.random()*2*Math.PI });
  }
  function render() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    particles.forEach(p => { p.y += p.speed; p.x += Math.sin(p.angle)*2; ctx.fillStyle = p.color; ctx.fillRect(p.x,p.y,p.w,p.h); });
  }
  let frame = 0;
  (function loop(){ frame++; render(); if(frame<200) requestAnimationFrame(loop); else document.body.removeChild(canvas); })();
}
function showCompleteBanner() {
  completeBanner.classList.add('show');
  launchConfetti();
  setTimeout(()=>completeBanner.classList.remove('show'),1500);
}

// ===== ê²Œì„ ë¡œì§ =====
function startQuiz() {
  const endRow = parseInt(endRowSelect.value, 10);
  pool = [];
  for (let i=0; i<=endRow; i++) pool.push(...ROWS[i].items);
  if (includeNCheck.checked) pool.push(...N_CHAR.items);
  if (katakanaMode.checked) pool = pool.map(item => ({k: toKatakana(item.k), a: item.a}));
  order = shuffle([...Array(pool.length).keys()]);
  idx = 0; started = true;
  total = correct = streak = 0;
  updateStats();
  renderTable();
  showQuestion();
}
function showQuestion() {
  if (idx >= order.length) { showCompleteBanner(); idx = 0; order = shuffle(order); }
  kanaEl.textContent = pool[order[idx]].k;
  answerEl.value = '';
  answerEl.focus();
}
function updateStats() {
  totalEl.textContent = total;
  correctEl.textContent = correct;
  accEl.textContent = total ? Math.round((correct/total)*100)+'%' : '0%';
  streakEl.textContent = streak;
}
function checkAnswer() {
  if (!started) return;
  const ans = normalize(answerEl.value);
  const correctAnswers = pool[order[idx]].a.map(normalize);
  total++;
  if (correctAnswers.includes(ans)) {
    correct++; streak++;
    kanaEl.classList.add('flash-correct');
    setTimeout(() => {
      kanaEl.classList.remove('flash-correct');
      idx++;
      showQuestion();
    }, 200);
  } else {
    streak = 0;
    kanaEl.classList.add('flash-wrong');
    setTimeout(()=>kanaEl.classList.remove('flash-wrong'),300);
  }
  updateStats();
}

// ===== ì´ë²¤íŠ¸ =====
startBtn.addEventListener('click', startQuiz);
answerEl.addEventListener('keydown', e => { if (e.key === 'Enter') checkAnswer(); });
revealBtn.addEventListener('click', () => { if(started) alert(pool[order[idx]].a.join(', ')); });
skipBtn.addEventListener('click', () => { if(started){ idx++; showQuestion(); } });

</script>
</body>
</html>
